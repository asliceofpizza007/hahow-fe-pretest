var k=e=>{throw TypeError(e)};var M=(e,t,s)=>t.has(e)||k("Cannot "+s);var n=(e,t,s)=>(M(e,t,"read from private field"),s?s.call(e):t.get(e)),g=(e,t,s)=>t.has(e)?k("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),j=(e,t,s,r)=>(M(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),S=(e,t,s)=>(M(e,t,"access private method"),s);import{S as U,s as Q,h as I,b as $,n as L,d as q,r as l,t as z,e as A,j as i,f as B,c as G,a as T,p as W,g as _}from"./index-CYl8eiwx.js";var f,x,c,m,b,N,E,V,J=(V=class extends U{constructor(t,s){super();g(this,b);g(this,f);g(this,x);g(this,c);g(this,m);j(this,f,t),this.setOptions(s),this.bindMethods(),S(this,b,N).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=n(this,f).defaultMutationOptions(t),Q(this.options,s)||n(this,f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,c),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&I(s.mutationKey)!==I(this.options.mutationKey)?this.reset():((r=n(this,c))==null?void 0:r.state.status)==="pending"&&n(this,c).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=n(this,c))==null||t.removeObserver(this)}onMutationUpdate(t){S(this,b,N).call(this),S(this,b,E).call(this,t)}getCurrentResult(){return n(this,x)}reset(){var t;(t=n(this,c))==null||t.removeObserver(this),j(this,c,void 0),S(this,b,N).call(this),S(this,b,E).call(this)}mutate(t,s){var r;return j(this,m,s),(r=n(this,c))==null||r.removeObserver(this),j(this,c,n(this,f).getMutationCache().build(n(this,f),this.options)),n(this,c).addObserver(this),n(this,c).execute(t)}},f=new WeakMap,x=new WeakMap,c=new WeakMap,m=new WeakMap,b=new WeakSet,N=function(){var s;const t=((s=n(this,c))==null?void 0:s.state)??$();j(this,x,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},E=function(t){L.batch(()=>{var s,r,a,d,h,y,C,O;if(n(this,m)&&this.hasListeners()){const p=n(this,x).variables,v=n(this,x).context;(t==null?void 0:t.type)==="success"?((r=(s=n(this,m)).onSuccess)==null||r.call(s,t.data,p,v),(d=(a=n(this,m)).onSettled)==null||d.call(a,t.data,null,p,v)):(t==null?void 0:t.type)==="error"&&((y=(h=n(this,m)).onError)==null||y.call(h,t.error,p,v),(O=(C=n(this,m)).onSettled)==null||O.call(C,void 0,t.error,p,v))}this.listeners.forEach(p=>{p(n(this,x))})})},V);function X(e,t){return typeof e=="function"?e(...t):!!e}function Y(){}function Z(e,t){const s=q(),[r]=l.useState(()=>new J(s,e));l.useEffect(()=>{r.setOptions(e)},[r,e]);const a=l.useSyncExternalStore(l.useCallback(h=>r.subscribe(L.batchCalls(h)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=l.useCallback((h,y)=>{r.mutate(h,y).catch(Y)},[r]);if(a.error&&X(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:d,mutateAsync:a.mutate}}const tt=A(["font-semibold","border","rounded","border-transparent"],{variants:{variant:{primary:["bg-au-primary/80","text-au-background","hover:bg-au-primary"],secondary:["bg-au-secondary/80","hover:bg-au-secondary"],accent:["bg-au-accent/80","text-au-background","hover:bg-au-accent"]},size:{small:["text-sm","py-1","px-2"],medium:["text-base","py-2","px-4"]},disabled:{true:"grayscale pointer-events-none"}},defaultVariants:{variant:"primary",size:"medium"}}),et=e=>z(tt(e)),D=({children:e,className:t,size:s,variant:r,disabled:a,...d})=>i.jsx("button",{...d,className:et({className:t,size:s,variant:r,disabled:a}),children:e}),st=A(["w-full","border","border-gray-300","rounded","focus:outline-none","bg-transparent"],{variants:{size:{small:["text-sm","p-1"],medium:["text-base","p-2"]}},defaultVariants:{size:"medium"}}),rt=e=>z(st(e)),nt=({className:e,size:t,...s})=>i.jsx("input",{...s,className:rt({className:e,size:t})}),at=({className:e,value:t,name:s,onIncrease:r,onDecrease:a,...d})=>i.jsxs("div",{...d,className:z(B("inline-block rounded-sm border border-au-primary overflow-hidden",e)),children:[i.jsx(D,{type:"button",className:"rounded-none",size:"small",onClick:r,children:"+"}),i.jsx(nt,{type:"text",value:t,name:s,className:"border-none w-[5em] text-center p-0",readOnly:!0}),i.jsx(D,{type:"button",className:"rounded-none",size:"small",onClick:a,children:"-"})]}),R=e=>Object.keys(e).reduce((t,s)=>t+e[s],0),w=G("/heroes/$heroId")({component:it,pendingComponent:()=>i.jsx("div",{children:"loading..."})});function it(){const e=w.useLoaderData(),{name:t}=w.useSearch(),{heroId:s}=w.useParams(),r=l.useRef(e.data?R(e.data):0),[a,d]=l.useState(()=>e.data??structuredClone(e.data));l.useEffect(()=>{d(structuredClone(e.data)),r.current=e.data?R(e.data):0},[e.data]);const h=l.useMemo(()=>a?r.current-R(a):r.current,[a]),y=l.useCallback(o=>()=>{d(u=>!u||h==0?u:{...u,[o]:u[o]+1})},[h]),C=l.useCallback(o=>()=>{d(u=>!u||u[o]==0?u:{...u,[o]:u[o]-1})},[]),O=q(),{mutate:p}=Z({mutationFn:W,mutationKey:["patchHeroState"],onSuccess:()=>{O.refetchQueries({queryKey:["heroState",s]})}}),v=async o=>{o.preventDefault();const u=new FormData(o.target),P={str:0,int:0,agi:0,luk:0};for(const[F,H]of u.entries())P[F]=Number(H);p({id:s,data:P})},K=l.useRef(null);return T(()=>{_.from(K.current,{y:150,scale:.7,duration:.3,ease:"back"})},{dependencies:[s]}),i.jsxs("section",{ref:K,className:"w-full",children:[t&&i.jsx("h3",{className:"font-bold text-2xl mb-3",children:t}),i.jsxs("form",{onSubmit:v,children:[i.jsx("div",{className:"grid grid-cols-[120px_1fr] gap-3",children:a&&Object.keys(a).map(o=>{const u=a[o];return i.jsxs(l.Fragment,{children:[i.jsx("label",{className:"flex items-center uppercase",children:o}),i.jsx("div",{className:"flex items-center",children:i.jsx(at,{value:u,name:o,onDecrease:C(o),onIncrease:y(o)})})]},o)})}),i.jsxs("div",{className:"flex justify-between items-center mt-4",children:[i.jsx("p",{children:`Remaining States: ${h}`}),i.jsx(D,{type:"submit",variant:"accent",disabled:h>0,children:"Save"})]})]})]})}export{w as Route};
